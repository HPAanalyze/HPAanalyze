---
title: "Working with HPAanalyze package"
author: "Anh N. Tran"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{"Working with HPAanalyze package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

library(HPAanalyze)
library(tibble)
library(dplyr)
```

## Introduction
Motivation:

HPAanalyze consists of

## Working with HPA Downloadable Data

HPA provides downloadable data...

Previously, another R package `hpar` was developed to...

HPA analyze provide tools to retrive and analyze these data via a set of functions including...

### Download and import data with `hpaDownload()`

```{r downloaded_data, warning=FALSE, message=FALSE}
downloaded_data <- hpaDownload(download_list = 'all')
summary(downloaded_data)
```

The `normal_tissue` dataset contains information about protein expression profiles in human tissues based on IHC staining. The datasets contain six columns: `ensembl` (Ensembl gene identifier); `gene` (HGNC symbol), `tissue` (tissue name); `cell_type` (annotated cell type); `level` (expression value); `reliability` (the gene reliability of the expression value).

```{r normal_tissue}
tibble::glimpse(downloaded_data$normal_tissue, give.attr = FALSE)
```

The `pathology` dataset contains information about protein expression profiles in human tumor tissue based on IHC staining. The datasets contain eleven columns: `ensembl` (Ensembl gene identifier); `gene` (HGNC symbol); `cancer` (cancer type); `high`, `medium`, `low`, `not_detected` (number of patients annotated for different staining levels); `prognostic_favorable`, `unprognostic_favorable`, `prognostic_unfavorable`, `unprognostic_unfavorable` (log-rank p values for patient survival and mRNA correlation).

```{r pathology}
tibble::glimpse(downloaded_data$pathology, give.attr = FALSE)
```

The `subcellular_location` dataset contains information about subcellular localization of proteins based on IF stanings of normal cells. The datasets contain eleven columns: `ensembl` (Ensembl gene identifier); `gene` (HGNC symbol); `reliability` (gene reliability score); `enhanced` (enhanced locations); `supported` (supported locations); `approved` (approved locations); `uncertain` (uncertain locations); `single_cell_var_intensity` (locations with single-cell variation in intensity); `single_cell_var_spatial` (locations with spatial single-cell variation); `cell_cycle_dependency` (locations with observed cell cycle dependency); `go_id` (Gene Ontology Cellular Component term identifier).

```{r subcellular_location}
tibble::glimpse(downloaded_data$subcellular_location, give.attr = FALSE)
```

The `rna_tissue` and `rna_cell_line` datasets contain RNA expression levels of 37 tissues and 64 cell lines based on RNA-seq. These datasets contain four columns each: `ensembl` (Ensembl gene identifier); `gene` (HGNC symbol); `tissue`/`cell_line` (type of sample); `value` + `unit` (expression level measured by transcripts per million).

```{r rna}
tibble::glimpse(downloaded_data$rna_tissue, give.attr = FALSE)
tibble::glimpse(downloaded_data$rna_cell_line, give.attr = FALSE)
```

Similarly, the `transcript_rna_tissue` and `transcript_rna_cell_line` datasets contain RNA isoform levels. These datasets contain four columns each: `ensembl` (Ensembl gene identifier); `transcript` (Ensembl transcript identifier); `tissue`/`cell_line` (type of sample); `value` (expression level measured by transcripts per million). Note that these datasets are significantly larger than others and should only be downloaded when necessary.

```{r}
tibble::glimpse(downloaded_data$transcript_rna_tissue, give.attr = FALSE)
tibble::glimpse(downloaded_data$transcript_rna_cell_line, give.attr = FALSE)
```

### List available data with `hpaListParam()`

To see what parameters are available for subsequent subsetting/visualizing, HPAanalyze includes the function `hpa_list_param()`. The input for this function is the list object

```{r list_param}
str(hpaListParam(downloaded_data))
```

### Subset data with `hpaSubset()`

```{r subset, message=FALSE, warning=FALSE}
data("hpa_downloaded_histology_v18")
downloaded_data <- c(hpa_downloaded_histology_v18, hpaDownload('rna'))
sapply(downloaded_data, nrow)

gene_list <- c('TP53', 'EGFR', 'CD44', 'PTEN', 'IDH1', 'IDH2', 'CYCS')
tissue_list <- c('breast', 'cerebellum', 'skin 1')
cancer_list <- c('breast cancer', 'glioma', 'melanoma')
cell_line_list <- c('A-431', 'A549', 'AF22', 'AN3-CA')

subset_data <- hpaSubset(data = downloaded_data,
                         target_gene = gene_list,
                         target_tissue = tissue_list,
                         target_cancer = cancer_list,
                         target_cell_line = cell_line_list)
sapply(subset_data, nrow)
```

### Export data with `hpaExport()`

```{r}
hpaExport(subset_data, file_name = 'subset.xlsx', file_type = 'xlsx')
```

## Visualize downloaded data

### Visualize tissue data with `hpaVisTissue()`

```{r fig.width=6}
gene_list <- c('TP53', 'EGFR', 'CD44', 'PTEN', 'IDH1', 'IDH2', 'CYCS')
tissue_list <- c('breast', 'cerebellum', 'skin 1')

hpaVisTissue(downloaded_data,
             target_gene = gene_list,
             target_tissue = tissue_list)
```


### Visualize expression in cancer with `hpaVisPatho()`

```{r fig.width=6}
gene_list <- c('TP53', 'EGFR', 'CD44', 'PTEN', 'IDH1', 'IDH2', 'CYCS')
cancer_list <- c('breast cancer', 'glioma', 'lymphoma', 'prostate cancer')
color_gray <- c('slategray1', 'slategray2', 'slategray3', 'slategray4')

hpaVisPatho(downloaded_data,
            target_gene = gene_list,
            target_cancer = cancer_list,
            color = color_gray)
```


### Visualize subcellular location data with `hpaVisSubcell()`

```{r fig.width=6}
gene_list <- c('TP53', 'EGFR', 'CD44', 'PTEN', 'IDH1', 'IDH2', 'CYCS')

hpaVisSubcell(downloaded_data,
              target_gene = gene_list)
```


## Working with individual xml files

### Import xml file with `hpaXmlGet()`

```{r}
CCNB1_xml <- hpaXmlGet('ENSG00000134057')
```

### View protein classes with `hpaXmlProtClass()`

```{r}
hpaXmlProtClass(CCNB1_xml)
```

### Get information and image of tissue expression with `hpaXmlTissueExpr()`

```{r}
hpaXmlTissueExpr(CCNB1_xml)
```
